<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .container {
          height: 50px;
          position: relative;
        } 
        .center {
          margin: 0;
          position: absolute;
          left: 40%;
        }
    </style>
    <script src="https://cdn.plot.ly/plotly-2.20.0.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body style="background-color:lightblue;">
    <h1 style="text-align:center">Headquarters Locations of the 100 Largest Companies in the United States</h1>
        <h2 style="text-align:center">Determined by Total Revenue Reported in 2022</h2>

    <div class="container">
        <div class="center">
            Select a company: 
            <select id="selecting" onchange="optionchange(this.value)">
            </select>
        </div>
    </div>
    <div id="plot"></div>
    <script>
        function stockNames(){
            // alert(stockSymbols) 
            var url = (`http://127.0.0.1:5000/api/v1.0/names`);
            d3.json(url).then(function(data) {
                // console.log(data)
                let selector = d3.select("#selecting")
                for (i=0; i < data.length;i++){
                    selector.append("option").text(data[i].name).property("value",data[i].symbol)
                }
            })
        }

        function optionchange(stockSymbols){
            // alert(stockSymbols) 

            var url = (`http://127.0.0.1:5000/api/v1.0/${stockSymbols}`);
            d3.json(url).then(function(data) {

                console.log(data)
                let dateList=[]
                let adjCloseList=[]
                for (i=0; i < data.length;i++){
                    var myDate = new Date(data[i].date);
                    dateList.push(myDate)
                    adjCloseList.push(data[i].adj_close)
                }
                console.log(`adjCloseList: ${adjCloseList}`)
                console.log(`dateList: ${dateList}`)
                var trace1 = {
                y: adjCloseList,
                x: dateList,
                mode: 'lines'
                };

                var data = [trace1];

                var layout = {
                title: '2022 Closing Stock Price',
                showlegend: false,
                height: 400,
                autosize: true
                };

                Plotly.newPlot('plot', data, layout);

                console.log(data)
            })
                // console.log(data[0].adj_close)
            
                // for (i=0; i < data.length;i++){
                //     console.log(data[i].date, data[i].adj_close)
                //     var trace1 = {
                //     x: data[i].date,
                //     y: data[i].adj_close,
                //     mode: 'lines'
                //     }
                //     };

                //     var data = [trace1];

                //     var layout = {
                //     title: 'Marker Size',
                //     showlegend: false,
                //     height: 600,
                //     width: 600
                //     };

                //     Plotly.newPlot('plot', data, layout);
                // }
            // )

        }
        stockNames()


    </script>

</body>